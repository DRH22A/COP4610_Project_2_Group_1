# Project 2: Elevator Kernel Module

 This project aimed to provide hands-on experience with system calls, kernel programming, concurrency, synchronization, and elevator scheduling algorithms. It consisted of parts that are built upon each other to deepen your knowledge and skills in these areas.

In Part 1, we added system calls to a C program and verifying their correctness using the strace tool, you gain hands-on experience with system call integration and learn about the available system calls for your machine. This part lays the foundation for understanding how system calls interact with the kernel.

Part 2 took us further into kernel programming. We developed a kernel module called my_timer that retrieves and stores the current time using the ktime_get_real_ts64() function. This module creates a proc entry and allows you to read the current time and elapsed time since the last call. This part helped us understand how kernel modules work, how to interact with kernel functions, and how to use proc interfaces for communication.

Part 3 focused on a more complex task: implementing a scheduling algorithm for a pet elevator. You create a kernel module representing the elevator, supporting operations like starting, stopping, and issuing requests. The module also provides a /proc/elevator entry to display important elevator information. This part challenges you to manage concurrency, synchronization, and efficient scheduling within the kernel environment.

Each part of the project built upon the knowledge and skills gained in the previous parts. Part 1 introduces you to system calls and their integration, which forms the basis for kernel programming in Part 2. Part 2 expands your understanding of kernel modules and communication through proc interfaces, setting the stage for the more advanced concepts explored in Part 3.

By completing this project, we acquired practical experience in system calls, kernel programming, concurrency, synchronization, and scheduling algorithms. These are essential skills for developing efficient and robust software systems, particularly in operating systems and low-level programming domains. Understanding system calls and kernel programming enables you to interact with and extend the functionality of the operating system, while concurrency, synchronization, and scheduling concepts are crucial for efficient resource management and multitasking in complex systems. 

## Group Members
- **Daniel Halterman**: drh22a@fsu.edu
- **Luke Stanton**: les22@fsu.edu

## Division of Labor

### Part 1: System Call Integration
- **Responsibilities**: Add system calls to the C program
- **Assigned to**: Luke Stanton

### Part 2: Timer Kernel Module
- **Responsibilities**: Created a kernel module that creates /proc/timer. It displays current time and elapsed time between reads using ktime_get_real_ts64(). Also implemented a Makefile that creates the files necessary to run my_timer.c.
- **Assigned to**: Daniel Halterman

### Part 3: Elevator Module
 **Responsibilities**:Implemented the pet elevator kernel module: designed data structures, elevator state machine (OFFLINE/IDLE/LOADING/UP/DOWN), and kthread to handle requests with timing rules. Added FIFO boarding with weight/capacity limits, directional logic, mutex protection, and system calls (start/request/stop) with validation and memory management. Built /proc/elevator interface for real-time status and handled full module init/cleanup including lists, kthread, mutex, and memory.
 **Assigned to**: Daniel Halterman, Luke Stanton

## File Listing
```
├─ part1/
│  ├─ empty.c
│  ├─ part1.c
│  ├─ empty.trace       # generated by program
│  ├─ part1.trace       # generated by program
│  └─ Makefile
├─ part2/
│  ├─ src/
│  │  └─ my_timer.c
│  └─ Makefile
├─ part3/
├── src/
│   └─ elevator.c       # Elevator kernel module source
├── Makefile            # Module build configuration
├── tests/
|   └─ elevator-test/
|       └─ consumer.c   # Start/stop the elevator program
|       └─ Makefile
|       └─ producer.c   # Pet request generator
|       └─ README.md
|       └─ wrappers.h
|       └─ consumer     # generated by program
|       └─ producer     # generated by program
|   └─ system-calls-test/
|       └─ Makefile
|       └─ README.md
|       └─ syscheck.c
|       └─ test-syscalls.c
|       └─ test-syscalls.h
├─ README.md
├─ Makefile


```
## How to Compile & Execute

### Requirements
- **Compiler**: `gcc`
- **Custom Linux kernel 6.16.12**


### Compilation
For a C/C++ example:
```bash
make
```
This will build the executable in ...
### Execution
```bash
make run
```
This will run the program ...


## Part 2 Compilation:
```
cd COP4610_Project_2_Group_1/part2/
make
```

Next, run this command to insert a specified kernel module into the running kernel

```
$ sudo insmod my_timer.ko
```

Afterwards, you can test how well it works with this command where X is the amount of seconds you want the terminal to sleep.

```
$ cat /proc/timer; sleep X; cat /proc/timer
```

Then go ahead and clean everything up with these two commands:

```
$ make clean
$ sudo rmmod my_timer 
```

## Part 3 Compilation

**IMPORTANT** YOU MUST HAVE LINUX-KERNEL-6.16.12 INSTALLED IN ORDER FOR THIS TO WORK

### Step 1: Compile the Elevator Module
```
cd COP4610_Project_2_Group_1/part3/
make
```

### Step 2: Compile the test programs
```
cd COP4610_Project_2_Group_1/part3/tests/elevator-test/
make
```

## Running part 3

For this part, you are going to want to open up two terminals.

### Step 1: Loading the elevator module
```
cd part3/
sudo insmod elevator.ko
```

### Step 2: Monitoring the elevator (Terminal 1)
Open a terminal and run:
```
watch -n1 cat /proc/elevator
```

### Step 3: Manipulating the elevator (Terminal 2)

Navigate to the test directory:
```
cd part3/tests/elevator-test/
```

**Start the elevator:**
```
./consumer --start
```

**Create pet requests:**

Create X random pet requests: (X being the number of pets)
```
./producer X
```

**Stop the elevator:**
```
./consumer --stop
```

### Step 4: Remove the module
When finished testing:
```
cd ../..
sudo rmmod elevator
```

## Development Log
Each member records their contributions here.

### Luke Stanton

| Date       | Work Completed / Notes |
|------------|------------------------|
| 2025-10-17 | Completed Part 1       |
| 2025-10-17 | Tested Part 1 (Linprog)|
| 2025-11-02 | Provisioned DO VM (part 3) |
| 2025-11-02 | Cloned linux-stable 6.16.12 (part 3) |
| 2025-11-05 | Generated required strace files (part 1) |
| 2025-11-05 | Completed Makefile and syscalls for part 3 |


### Daniel Halterman

| Date       | Work Completed / Notes |
|------------|------------------------|
| 2025-10-25 | Completed Part 2       |
| 2025-10-27 | Downloaded and Installed the Kernel   |
| 2025-11-5  | Put a lot of work into the elevator.c file over a few days  |
| 2025-11-8  | Fixing up some bugs and adding some finishing touches to the README  |


## Meetings
There were no formal meetings but constant communication through email. We will have a meeting the days before our presentation so we are ready.


## Bugs
None that we are currently aware of.


## Considerations
- This pet elevator boards based on First-In-First-Out
- Pets can only board if the capacity and weight limits can handle it
- Once the elevator stops, the elevator will finish with the current pets and ignore new waiting pets
- The elevator is non-circular (it cannot jump from floor 5 to floor 1)